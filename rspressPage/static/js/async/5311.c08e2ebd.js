"use strict";(self.webpackChunkAutox_ozobi_Docs=self.webpackChunkAutox_ozobi_Docs||[]).push([["5311"],{942:function(e,n,t){t.r(n),t.d(n,{default:()=>a});var r=t(5893),s=t(65);function c(e){let n=Object.assign({div:"div",p:"p",pre:"pre",code:"code",h1:"h1",a:"a",hr:"hr",h2:"h2",ul:"ul",li:"li"},(0,s.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.div,{className:"rspress-directive info",children:[(0,r.jsx)(n.div,{className:"rspress-directive-title",children:"前情提要"}),(0,r.jsxs)(n.div,{className:"rspress-directive-content",children:["\n",(0,r.jsx)(n.p,{children:"安装 termux(版本需 0.95 以上)"}),"\n",(0,r.jsx)(n.p,{children:"编辑 ~/.termux/termux.properties 文件, 将 allow-external-apps=true 前面的注释 # 去掉, 保存退出"}),"\n",(0,r.jsx)(n.p,{children:"(如果有)比如小米：手机需要开启 USB 调试(安全设置) - 可在开发者选项里找到"}),"\n",(0,r.jsx)(n.p,{children:"(如果有)比如 oppo：手机需要开启 禁止权限监控 - 可在开发者选项里找到"}),"\n",(0,r.jsx)(n.p,{children:"授予 termux 执行命令权限"}),"\n",(0,r.jsx)(n.p,{children:"可在应用权限页面授予，找不到或者懒得找可以通过 shell 命令授予"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"# adb 连接手机后授予 termux 权限， autoxjs 或者打包后的应用\nadb shell pm grant 包名 com.termux.permission.RUN_COMMAND\n"})}),"\n"]})]}),"\n",(0,r.jsxs)(n.div,{className:"rspress-directive info",children:[(0,r.jsx)(n.div,{className:"rspress-directive-title",children:"提示"}),(0,r.jsxs)(n.div,{className:"rspress-directive-content",children:["\n",(0,r.jsx)(n.p,{children:"如果执行命令没反应的话, 可以先手动打开 termux\n"})]})]}),"\n",(0,r.jsxs)(n.h1,{id:"termuxexeccommand",children:["termux.exec(command)",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#termuxexeccommand",children:"#"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'// 只是发送命令, 无法获取结果\n// 示例:\ntermux.exec("pwd");\n'})}),"\n",(0,r.jsxs)(n.h1,{id:"termuxexeccommand-callback",children:["termux.exec(command, callback)",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#termuxexeccommand-callback",children:"#"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'// 向 termux 发送命令, 并通过回调获取结果\n// 示例:\ntermux.exec("pwd", (result) => {\n    log(result); // 日志应打印出: {stdout=/data/data/com.termux/files/home, stderr=, exitCode=0, errmsg=, err=-1}\n});\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.div,{className:"rspress-directive warning",children:[(0,r.jsx)(n.div,{className:"rspress-directive-title",children:"稳定性: 弃用"}),(0,r.jsxs)(n.div,{className:"rspress-directive-content",children:["\n",(0,r.jsx)(n.p,{children:"65824 之后修改为 termux.exec(command, callback)\n"})]})]}),"\n",(0,r.jsxs)(n.h1,{id:"termuxcommand-options",children:["termux(command [,options])",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#termuxcommand-options",children:"#"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'// 输出字符串到文件\ntermux("echo \'hello world\' > /sdcard/termuxRunResult.autox");\n\n// 获取执行结果\ntermux("ls /sdcard/", {\n    outputPath: "/sdcard/termux_output.txt",\n    callback: (result) => {\n        log("输出结果:\\n" + result);\n        toast(result);\n    },\n    runBackground: false, // 需要打开 termux 的悬浮窗、后台弹出界面权限\n    sessionAction: 0, //指定 会话动作\n    clean: false, // 执行完后清理输出文件\n    top: true, // 不创建新的活动\n    checkGap: 100, // 检查间隔时间，单位毫秒\n    checkCount: 600, // 检查次数\n});\n'})}),"\n",(0,r.jsxs)(n.h2,{id:"sendtermuxintentintent",children:["sendTermuxIntent(intent)",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sendtermuxintentintent",children:"#"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"intent"})," Intent 意图"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"return"})," void"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"发送 Intent 到 Termux"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'// 自己构建 intent\nfunction getTermuxIntent(command, runBackground, sessionAction, top) {\n    let intent = new Intent();\n    let args = stringArray("-c", command);\n    intent.setClassName("com.termux", "com.termux.app.RunCommandService");\n    intent.setAction("com.termux.RUN_COMMAND");\n    intent.putExtra("com.termux.RUN_COMMAND_PATH", "/data/data/com.termux/files/usr/bin/bash");\n    intent.putExtra("com.termux.RUN_COMMAND_ARGUMENTS", args);\n    intent.putExtra("com.termux.RUN_COMMAND_WORKDIR", "/data/data/com.termux/files/home");\n    intent.putExtra("com.termux.RUN_COMMAND_BACKGROUND", runBackground);\n    intent.putExtra("com.termux.RUN_COMMAND_SESSION_ACTION", sessionAction);\n    if (top) {\n        intent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);\n    }\n    return intent;\n}\nlet myIntent = getTermuxIntent("echo \'termux 运行成功\' > " + files.cwd() + "/termuxRunResult.autox", true, 0, true);\n// 发送 intent 执行 Termux 命令\nsendTermuxIntent(myIntent);\n'})})]})}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}let a=i;i.__RSPRESS_PAGE_META={},i.__RSPRESS_PAGE_META["doc%2Fmodification%2Fglobals%2Ftermux.md"]={toc:[{text:"sendTermuxIntent(intent)",id:"sendtermuxintentintent",depth:2}],title:"termux(command [,options])",headingTitle:"termux(command [,options])",frontmatter:{}}}}]);